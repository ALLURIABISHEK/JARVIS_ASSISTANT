<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jarvis AI - Neural Intelligence</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --royal-blue: #0047AB;
      --deep-blue: #001F3F;
      --electric-blue: #00D4FF;
      --gold: #FFD700;
      --platinum: #E5E4E2;
      --dark-bg: #0A0E27;
      --glass-bg: rgba(0, 71, 171, 0.08);
      --glass-border: rgba(0, 212, 255, 0.3);
      --neon-glow: rgba(0, 212, 255, 0.6);
    }

    body {
      font-family: 'Rajdhani', sans-serif;
      background: linear-gradient(135deg, #0A0E27 0%, #001F3F 50%, #0A1628 100%);
      color: var(--platinum);
      min-height: 100vh;
      overflow: hidden;
      position: relative;
    }

    /* Animated Background */
    .bg-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      background: radial-gradient(circle, var(--electric-blue) 0%, transparent 70%);
      border-radius: 50%;
      animation: float 20s infinite ease-in-out;
      opacity: 0.15;
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0) scale(1); }
      33% { transform: translate(100px, -100px) scale(1.2); }
      66% { transform: translate(-100px, 100px) scale(0.8); }
    }

    .grid-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(0, 212, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 212, 255, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      z-index: 0;
      animation: gridScroll 20s linear infinite;
    }

    @keyframes gridScroll {
      0% { transform: translate(0, 0); }
      100% { transform: translate(50px, 50px); }
    }

    /* Main Container */
    .container {
      position: relative;
      z-index: 1;
      width: 100%;
      height: 100vh;
      display: grid;
      grid-template-columns: 380px 1fr;
      gap: 25px;
      padding: 25px;
    }

    /* Sidebar */
    .sidebar {
      background: linear-gradient(145deg, rgba(0, 71, 171, 0.12), rgba(0, 31, 63, 0.15));
      border: 2px solid var(--glass-border);
      border-radius: 30px;
      padding: 30px;
      backdrop-filter: blur(40px);
      box-shadow: 
        0 8px 32px 0 rgba(0, 71, 171, 0.3),
        inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      gap: 25px;
      overflow-y: visible;
      position: relative;
    }

    .sidebar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 200px;
      background: radial-gradient(ellipse at top, rgba(0, 212, 255, 0.15), transparent);
      pointer-events: none;
      border-radius: 30px 30px 0 0;
    }

    /* Logo */
    .logo-container {
      text-align: center;
      margin-bottom: 15px;
      position: relative;
    }

    .logo-icon {
      width: 100px;
      height: 100px;
      margin: 0 auto 20px;
      position: relative;
      animation: logoRotate 10s linear infinite;
    }

    .logo-icon::before {
      content: '';
      position: absolute;
      inset: -10px;
      background: conic-gradient(from 0deg, transparent, var(--electric-blue), transparent);
      border-radius: 50%;
      animation: spin 4s linear infinite;
      opacity: 0.5;
    }

    .logo-icon::after {
      content: '‚ö°';
      position: absolute;
      inset: 10px;
      background: linear-gradient(145deg, var(--royal-blue), var(--deep-blue));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      box-shadow: 
        0 0 40px var(--neon-glow),
        inset 0 2px 10px rgba(0, 212, 255, 0.3);
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes logoRotate {
      0%, 100% { transform: rotateY(0deg); }
      50% { transform: rotateY(180deg); }
    }

    .logo-text {
      font-family: 'Orbitron', sans-serif;
      font-size: 42px;
      font-weight: 900;
      background: linear-gradient(135deg, var(--electric-blue), var(--gold), var(--electric-blue));
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 4px;
      animation: gradientShift 3s ease infinite;
      text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .logo-subtitle {
      font-size: 13px;
      color: var(--electric-blue);
      letter-spacing: 3px;
      text-transform: uppercase;
      margin-top: 8px;
      opacity: 0.8;
    }

    /* Stats Card */
    .stats-card {
      background: linear-gradient(145deg, rgba(0, 71, 171, 0.1), rgba(0, 0, 0, 0.3));
      border: 1px solid rgba(0, 212, 255, 0.2);
      border-radius: 20px;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    .stats-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.1), transparent);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      to { left: 100%; }
    }

    .stats-card h3 {
      font-family: 'Orbitron', sans-serif;
      font-size: 15px;
      color: var(--electric-blue);
      margin-bottom: 18px;
      text-transform: uppercase;
      letter-spacing: 2px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .stats-card h3::before {
      content: '‚óÜ';
      color: var(--gold);
      animation: pulse 2s infinite;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0, 212, 255, 0.1);
      font-size: 14px;
      transition: all 0.3s;
    }

    .stat-item:hover {
      padding-left: 10px;
      background: rgba(0, 212, 255, 0.05);
      border-radius: 8px;
    }

    .stat-item:last-child {
      border-bottom: none;
    }

    .stat-label {
      color: rgba(229, 228, 226, 0.7);
      font-weight: 500;
    }

    .stat-value {
      color: var(--electric-blue);
      font-weight: 700;
      font-family: 'Orbitron', sans-serif;
      text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
    }

    /* Upload Section */
    .upload-section {
      background: linear-gradient(145deg, rgba(0, 71, 171, 0.15), rgba(0, 31, 63, 0.2));
      border: 2px dashed var(--electric-blue);
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .upload-section::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, rgba(0, 212, 255, 0.2), transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .upload-section:hover::before {
      opacity: 1;
    }

    .upload-section:hover {
      transform: translateY(-5px) scale(1.02);
      border-color: var(--gold);
      box-shadow: 
        0 10px 40px rgba(0, 212, 255, 0.3),
        0 0 60px rgba(255, 215, 0, 0.2);
    }

    .upload-section input {
      display: none;
    }

    .upload-icon {
      font-size: 60px;
      margin-bottom: 15px;
      animation: floatIcon 3s ease-in-out infinite;
      filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.6));
    }

    @keyframes floatIcon {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .upload-text {
      font-size: 18px;
      font-weight: 600;
      color: var(--platinum);
      margin-bottom: 8px;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }

    .upload-subtext {
      font-size: 13px;
      color: rgba(229, 228, 226, 0.6);
      margin-bottom: 20px;
    }

    .upload-button {
      background: linear-gradient(135deg, var(--royal-blue), var(--electric-blue));
      border: 2px solid var(--electric-blue);
      border-radius: 15px;
      color: white;
      padding: 14px 30px;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 2px;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
      box-shadow: 0 5px 25px rgba(0, 212, 255, 0.4);
    }

    .upload-button::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transform: translateX(-100%);
      transition: transform 0.6s;
    }

    .upload-button:hover::before {
      transform: translateX(100%);
    }

    .upload-button:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 35px rgba(0, 212, 255, 0.6);
      border-color: var(--gold);
    }

    .upload-button:active {
      transform: scale(0.98);
    }

    .upload-status {
      margin-top: 15px;
      font-size: 13px;
      padding: 12px;
      border-radius: 10px;
      display: none;
      font-weight: 600;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .upload-status.success {
      background: rgba(0, 212, 170, 0.2);
      border: 1px solid rgba(0, 212, 170, 0.5);
      color: #00D4AA;
      display: block;
    }

    .upload-status.error {
      background: rgba(255, 59, 48, 0.2);
      border: 1px solid rgba(255, 59, 48, 0.5);
      color: #ff6b6b;
      display: block;
    }

    /* Chat Container */
    .chat-container {
      background: linear-gradient(145deg, rgba(0, 71, 171, 0.1), rgba(0, 31, 63, 0.15));
      border: 2px solid var(--glass-border);
      border-radius: 30px;
      backdrop-filter: blur(40px);
      box-shadow: 
        0 8px 32px 0 rgba(0, 71, 171, 0.3),
        inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    .chat-header {
      background: linear-gradient(135deg, var(--royal-blue), var(--deep-blue));
      padding: 25px 30px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .chat-header::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.1), transparent);
      animation: headerShine 3s infinite;
    }

    @keyframes headerShine {
      to { transform: translateX(100%); }
    }

    .header-info {
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 1;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      background: var(--gold);
      border-radius: 50%;
      box-shadow: 0 0 15px var(--gold);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.8; }
    }

    .header-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: white;
      text-shadow: 0 0 20px rgba(0, 212, 255, 0.8);
    }

    .header-badge {
      font-size: 12px;
      padding: 6px 14px;
      background: rgba(255, 215, 0, 0.2);
      border: 1px solid var(--gold);
      border-radius: 20px;
      color: var(--gold);
      font-weight: 600;
      letter-spacing: 1px;
      z-index: 1;
    }

    /* Chat Messages */
    .chat-messages {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .message {
      display: flex;
      align-items: flex-start;
      animation: messageSlide 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      gap: 12px;
    }

    @keyframes messageSlide {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .message.user {
      justify-content: flex-end;
    }

    .message-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      flex-shrink: 0;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      position: relative;
    }

    .message.user .message-avatar {
      background: linear-gradient(135deg, var(--gold), #FFA500);
      order: 2;
      animation: avatarGlow 2s infinite;
    }

    @keyframes avatarGlow {
      0%, 100% { box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4); }
      50% { box-shadow: 0 4px 30px rgba(255, 215, 0, 0.8); }
    }

    .message.assistant .message-avatar {
      background: linear-gradient(135deg, var(--royal-blue), var(--electric-blue));
      animation: avatarGlow 2s infinite;
    }

    .message-content {
      max-width: 70%;
      padding: 18px 24px;
      border-radius: 20px;
      word-wrap: break-word;
      font-size: 16px;
      line-height: 1.6;
      position: relative;
      font-weight: 500;
    }

    .message.user .message-content {
      background: linear-gradient(135deg, var(--royal-blue), var(--deep-blue));
      color: white;
      border-bottom-right-radius: 6px;
      box-shadow: 0 4px 20px rgba(0, 71, 171, 0.4);
      border: 1px solid rgba(0, 212, 255, 0.3);
    }

    .message.assistant .message-content {
      background: linear-gradient(145deg, rgba(0, 71, 171, 0.15), rgba(0, 0, 0, 0.3));
      border: 1px solid rgba(0, 212, 255, 0.3);
      color: var(--platinum);
      border-bottom-left-radius: 6px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    }

    .message-meta {
      font-size: 11px;
      color: rgba(229, 228, 226, 0.5);
      margin-top: 8px;
      font-style: italic;
    }

    /* Chat Input */
    .chat-input-container {
      padding: 25px 30px;
      background: linear-gradient(145deg, rgba(0, 0, 0, 0.4), rgba(0, 71, 171, 0.1));
      border-top: 2px solid rgba(0, 212, 255, 0.2);
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .chat-input {
      flex: 1;
      padding: 18px 25px;
      background: linear-gradient(145deg, rgba(0, 71, 171, 0.1), rgba(0, 0, 0, 0.3));
      border: 2px solid rgba(0, 212, 255, 0.3);
      border-radius: 25px;
      font-size: 16px;
      color: var(--platinum);
      outline: none;
      transition: all 0.3s;
      font-family: 'Rajdhani', sans-serif;
      font-weight: 500;
    }

    .chat-input::placeholder {
      color: rgba(229, 228, 226, 0.4);
    }

    .chat-input:focus {
      border-color: var(--electric-blue);
      box-shadow: 
        0 0 0 4px rgba(0, 212, 255, 0.2),
        0 0 30px rgba(0, 212, 255, 0.3);
      background: linear-gradient(145deg, rgba(0, 71, 171, 0.15), rgba(0, 0, 0, 0.4));
    }

    .send-button {
      background: linear-gradient(135deg, var(--royal-blue), var(--electric-blue));
      border: 2px solid var(--electric-blue);
      border-radius: 50%;
      width: 60px;
      height: 60px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
      box-shadow: 0 5px 25px rgba(0, 212, 255, 0.4);
    }

    .send-button::before {
      content: '';
      position: absolute;
      inset: -5px;
      background: conic-gradient(from 0deg, var(--electric-blue), var(--gold), var(--electric-blue));
      border-radius: 50%;
      opacity: 0;
      transition: opacity 0.3s;
      animation: spin 2s linear infinite;
    }

    .send-button:hover::before {
      opacity: 0.6;
    }

    .send-button:hover {
      transform: scale(1.15) rotate(90deg);
      box-shadow: 0 8px 40px rgba(0, 212, 255, 0.6);
    }

    .send-button:active {
      transform: scale(0.95) rotate(90deg);
    }

    .send-button span {
      position: relative;
      z-index: 1;
    }

    /* Typing Indicator */
    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 18px 24px;
      background: linear-gradient(145deg, rgba(0, 71, 171, 0.15), rgba(0, 0, 0, 0.3));
      border: 1px solid rgba(0, 212, 255, 0.3);
      border-radius: 20px;
      width: fit-content;
    }

    .typing-indicator span {
      width: 10px;
      height: 10px;
      background: var(--electric-blue);
      border-radius: 50%;
      animation: typing 1.4s infinite;
      box-shadow: 0 0 10px var(--electric-blue);
    }

    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
      0%, 80%, 100% { transform: translateY(0) scale(1); opacity: 0.5; }
      40% { transform: translateY(-15px) scale(1.2); opacity: 1; }
    }

    /* Welcome Message */
    .welcome-message {
      text-align: center;
      margin-top: 60px;
      animation: fadeIn 1s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .welcome-message h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 32px;
      background: linear-gradient(135deg, var(--electric-blue), var(--gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 700;
      margin-bottom: 15px;
      text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
    }

    .welcome-message p {
      color: rgba(229, 228, 226, 0.7);
      font-size: 18px;
      font-weight: 500;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, var(--royal-blue), var(--electric-blue));
      border-radius: 10px;
      border: 2px solid rgba(0, 0, 0, 0.3);
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, var(--electric-blue), var(--gold));
    }

    @media (max-width: 1024px) {
      .container {
        grid-template-columns: 1fr;
      }
      .sidebar {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Animated Background -->
  <div class="bg-animation">
    <div class="particle" style="width: 200px; height: 200px; top: 10%; left: 10%; animation-delay: 0s;"></div>
    <div class="particle" style="width: 150px; height: 150px; top: 60%; left: 70%; animation-delay: 5s;"></div>
    <div class="particle" style="width: 180px; height: 180px; top: 30%; left: 80%; animation-delay: 10s;"></div>
    <div class="particle" style="width: 220px; height: 220px; top: 70%; left: 20%; animation-delay: 7s;"></div>
  </div>
  <div class="grid-overlay"></div>

  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="logo-container">
        <div class="logo-icon"></div>
        <div class="logo-text">JARVIS</div>
        <div class="logo-subtitle">Neural Intelligence</div>
      </div>
      
      <div class="stats-card">
        <h3>System Status</h3>
        <div class="stat-item">
          <span class="stat-label">Documents</span>
          <span class="stat-value" id="statDocs">Loading...</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">LLM Model</span>
          <span class="stat-value" id="statLLM">Loading...</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Vector DB</span>
          <span class="stat-value" id="statDB">Loading...</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Embeddings</span>
          <span class="stat-value" id="statEmbed">Loading...</span>
        </div>
      </div>

      <div class="upload-section" onclick="document.getElementById('fileInput').click()">
        <div class="upload-icon">üöÄ</div>
        <div class="upload-text">Upload Documents</div>
        <div class="upload-subtext">PDF or TXT files (max 16MB)</div>
        <input type="file" id="fileInput" accept=".txt,.pdf">
        <button class="upload-button" onclick="event.stopPropagation(); uploadFile()">
          Select File
        </button>
        <div class="upload-status" id="uploadStatus"></div>
      </div>
    </div>

    <!-- Chat Container -->
    <div class="chat-container">
      <div class="chat-header">
        <div class="header-info">
          <div class="status-indicator">
            <span class="status-dot"></span>
            <span class="header-title">JARVIS AI</span>
          </div>
        </div>
        <span class="header-badge">GROQ + PINECONE</span>
      </div>

      <div class="chat-messages" id="chatMessages">
        <div class="welcome-message">
          <h2>‚ö° Welcome to Jarvis Neural Intelligence</h2>
          <p>Upload your documents and experience the future of AI assistance</p>
        </div>
      </div>

      <div class="chat-input-container">
        <input type="text" id="messageInput" class="chat-input" placeholder="Ask me anything about your documents...">
        <button id="sendButton" class="send-button"><span>‚û§</span></button>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:5000';
    const chatMessages = document.getElementById('chatMessages');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');
    const fileInput = document.getElementById('fileInput');
    const uploadStatus = document.getElementById('uploadStatus');

    // Load stats on page load
    loadStats();

    async function loadStats() {
      try {
        const res = await fetch(`${API_URL}/api/stats`);
        const data = await res.json();
        
        document.getElementById('statDocs').textContent = data.total_vectors || '0';
        document.getElementById('statLLM').textContent = 'Groq Llama 3.3';
        document.getElementById('statDB').textContent = 'Pinecone';
        document.getElementById('statEmbed').textContent = 'MiniLM-L6';
      } catch (error) {
        console.error('Failed to load stats:', error);
        document.getElementById('statDocs').textContent = 'Offline';
        document.getElementById('statLLM').textContent = 'Offline';
        document.getElementById('statDB').textContent = 'Offline';
        document.getElementById('statEmbed').textContent = 'Offline';
      }
    }

    function addMessage(content, isUser = false, meta = null) {
      const msg = document.createElement('div');
      msg.className = `message ${isUser ? 'user' : 'assistant'}`;
      
      const avatar = document.createElement('div');
      avatar.className = 'message-avatar';
      avatar.textContent = isUser ? 'üë§' : 'ü§ñ';
      
      const contentWrapper = document.createElement('div');
      const bubble = document.createElement('div');
      bubble.className = 'message-content';
      bubble.textContent = content;
      
      contentWrapper.appendChild(bubble);
      
      if (meta) {
        const metaDiv = document.createElement('div');
        metaDiv.className = 'message-meta';
        metaDiv.textContent = meta;
        contentWrapper.appendChild(metaDiv);
      }
      
      msg.appendChild(avatar);
      msg.appendChild(contentWrapper);
      chatMessages.appendChild(msg);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      // Remove welcome message
      const welcome = document.querySelector('.welcome-message');
      if (welcome) welcome.remove();
    }

    function showTyping() {
      const typing = document.createElement('div');
      typing.className = 'message assistant';
      typing.id = 'typing';
      typing.innerHTML = `
        <div class="message-avatar">ü§ñ</div>
        <div class="typing-indicator">
          <span></span><span></span><span></span>
        </div>`;
      chatMessages.appendChild(typing);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function hideTyping() {
      const typing = document.getElementById('typing');
      if (typing) typing.remove();
    }

    async function sendMessage() {
      const question = messageInput.value.trim();
      if (!question) return;

      addMessage(question, true);
      messageInput.value = '';
      sendButton.disabled = true;
      messageInput.disabled = true;

      showTyping();

      try {
        const res = await fetch(`${API_URL}/api/chat`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question })
        });
        const data = await res.json();
        hideTyping();

        if (data.answer) {
          const meta = data.sources ? `üìö Sources: ${data.sources.join(', ')}` : null;
          addMessage(data.answer, false, meta);
        } else if (data.error) {
          addMessage(`‚ö†Ô∏è Error: ${data.error}`, false);
        }
      } catch (error) {
        hideTyping();
        addMessage("üö´ Connection error. Please ensure the backend server is running on http://localhost:5000", false);
      }

      sendButton.disabled = false;
      messageInput.disabled = false;
      messageInput.focus();
    }

    async function uploadFile() {
      const file = fileInput.files[0];
      if (!file) {
        uploadStatus.className = 'upload-status error';
        uploadStatus.textContent = '‚ö†Ô∏è Please select a file first';
        return;
      }

      // Check file size (16MB max)
      if (file.size > 16 * 1024 * 1024) {
        uploadStatus.className = 'upload-status error';
        uploadStatus.textContent = '‚ö†Ô∏è File too large (max 16MB)';
        return;
      }

      // Check file type
      const fileExt = file.name.split('.').pop().toLowerCase();
      if (!['txt', 'pdf'].includes(fileExt)) {
        uploadStatus.className = 'upload-status error';
        uploadStatus.textContent = '‚ö†Ô∏è Only .txt and .pdf files allowed';
        return;
      }

      const formData = new FormData();
      formData.append('file', file);

      uploadStatus.className = 'upload-status';
      uploadStatus.textContent = '‚è≥ Uploading to Pinecone...';
      uploadStatus.style.display = 'block';

      try {
        const res = await fetch(`${API_URL}/api/upload`, {
          method: 'POST',
          body: formData
        });
        const data = await res.json();

        if (data.success) {
          uploadStatus.className = 'upload-status success';
          uploadStatus.textContent = `‚úì ${data.message}`;
          fileInput.value = '';
          loadStats(); // Refresh stats
          
          addMessage(`üìÑ Successfully uploaded "${data.filename}" to Pinecone! Created ${data.chunks_created} vector embeddings.`, false);
        } else {
          uploadStatus.className = 'upload-status error';
          uploadStatus.textContent = `‚úó ${data.error}`;
        }
      } catch (error) {
        uploadStatus.className = 'upload-status error';
        uploadStatus.textContent = '‚úó Upload failed - Server connection error';
        console.error('Upload error:', error);
      }

      setTimeout(() => {
        uploadStatus.style.display = 'none';
      }, 5000);
    }

    // Event listeners
    sendButton.addEventListener('click', sendMessage);
    messageInput.addEventListener('keypress', e => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // File input change event
    fileInput.addEventListener('change', () => {
      const file = fileInput.files[0];
      if (file) {
        uploadStatus.className = 'upload-status';
        uploadStatus.textContent = `üìÅ Selected: ${file.name}`;
        uploadStatus.style.display = 'block';
      }
    });

    console.log('%c‚ö° JARVIS Neural Intelligence System Online', 'color: #00D4FF; font-size: 20px; font-weight: bold;');
    console.log('%cPowered by Groq + Pinecone', 'color: #FFD700; font-size: 14px;');
  </script>
</body>
</html>